import 'dart:convert';
import 'dart:math' as math;

import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';
import 'package:timeago/timeago.dart' as timeago;
import 'lat_lng.dart';
import 'place.dart';
import 'uploaded_file.dart';
import '/backend/schema/structs/index.dart';
import '/backend/schema/enums/enums.dart';
import '/backend/supabase/supabase.dart';

bool hasUploadedMedia(String? mediaPath) {
  return mediaPath != null && mediaPath.isNotEmpty;
}

String getAdminRole() {
  return "Admin";
}

String getUserRole() {
  return 'User';
}

String? getInitials(String fullName) {
  List<String> words = fullName.split(' ');
  List<String> initials = words.where((s) => s.isNotEmpty).toList();
  String firstLetter = initials.first.substring(0, 1);
  String secondLetter =
      (initials.length > 1 ? initials.last.substring(0, 1) : '');
  return firstLetter + secondLetter;
}

bool? isLastStep(
  int indexListSteps,
  int? totalSteps,
) {
  bool isLast = false;
  totalSteps ?? 0;
  isLast = indexListSteps == totalSteps! - 1 ? true : false;
  return isLast;
}

String getFilterLineContent(
  String? author,
  String? event,
  String? year,
  List<String>? topics,
  String? journey,
  String? group,
) {
  String baseline = '';

  if (author!.trim().isNotEmpty) {
    baseline += '${baseline.isNotEmpty ? ", " : ""}Author = $author';
  }
  if (event!.trim().isNotEmpty) {
    baseline += '${baseline.isNotEmpty ? ", " : ""}event = $event';
  }

  if (year!.trim().isNotEmpty) {
    baseline += '${baseline.isNotEmpty ? ", " : ""}year = $year';
  }

  if (topics!.isNotEmpty) {
    baseline +=
        '${baseline.isNotEmpty ? ", " : ""}topics = ${topics.join(', ')}';
  }

  if (journey!.trim().isNotEmpty) {
    baseline += '${baseline.isNotEmpty ? ", " : ""}journey = $journey';
  }

  if (group!.trim().isNotEmpty) {
    baseline += '${baseline.isNotEmpty ? ", " : ""}group = $group';
  }

  if (baseline.isNotEmpty) {
    return 'Filter by $baseline';
  } else {
    return '';
  }
}

OrderSQLTypeStruct getOrderSQL(SortContentType contentType) {
  OrderSQLTypeStruct orderSQL = OrderSQLTypeStruct(column: 'title', asc: true);

  switch (contentType) {
    case SortContentType.mostLiked:
      orderSQL.column = 'num_likes';
      orderSQL.asc = false;
      //response = supabase
      //    .from('view_content')
      //    .select('*')
      //    .order('num_likes', ascending: false);
      break;
    case SortContentType.mostViewed:
      orderSQL.column = 'num_views';
      orderSQL.asc = false;
      //response = supabase
      //    .from('view_content')
      //    .select('*')
      //    .order('num_views', ascending: false);
      break;
    case SortContentType.mostRecent:
      orderSQL.column = 'date_published';
      orderSQL.asc = false;
      //response = supabase
      //    .from('view_content')
      //    .select('*')
      //    .order('date_published', ascending: false);
      break;
    case SortContentType.oldest:
      orderSQL.column = 'date_published';
      orderSQL.asc = true;
      //response = supabase
      //    .from('view_content')
      //    .select('*')
      //    .order('date_published', ascending: true);
      break;
    default:
      orderSQL.column = 'title';
      orderSQL.asc = true;
  }
  return orderSQL;
}
